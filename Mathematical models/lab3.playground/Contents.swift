import UIKit

var array = [13.45659,
             25.5265972,
             31.891294,
             33.896088125,
             39.535173359375,
             39.4342870019531,
             37.385859861084,
             35.9881870542297,
             34.406819648037,
             31.4007433612218,
             32.0418434117112,
             25.9802850257288,
             26.5313159278739,
             21.4193441471605,
             21.5208815989686,
             20.1017208142499,
             22.273899648833,
             17.8950713950021,
             22.0114718723317,
             19.3997483770689,
             15.6328160090193,
             15.7184582672049,
             13.8648932095391,
             14.6558178838977,
             11.5652806425738,
             13.9548762141246,
             12.9342567762634,
             11.0331321146587,
             15.9781377893976,
             12.2183517075263,
             8.38871535043803,
             8.93337373014769,
             10.676011800265,
             11.1557536150213,
             11.5816469304856,
             8.83551311468143,
             11.5159727319761,
             10.4924949579515,
             12.2752736388119,
             10.4541786156636,
             10.9359038749831,
             11.5730376521933,
             12.2684377981064,
             12.7680967126711,
             9.8505173530832,
             9.35717723106979,
             9.92574192502755,
             9.43928094528023,
             8.86618380403104,
             11.3046821549603,
             6.26964788041509,
             9.18467001648184,
             11.0985234177606,
             11.3898040742947,
             8.89931500282358,
             12.1840576433324,
             13.1752056998122,
             11.9096023712579,
             11.6327379252923,
             9.39355957246204,
             9.14532460427773,
             11.6888037625231,
             10.2388248112928,
             12.217896286695,
             8.48210940221845,
             10.2803600904614,
             10.8630431642939,
             16.3342665826123,
             6.85160080767715,
             9.94573074263602,
             7.10266473924541,
             11.4627591670439,
             11.0832130363165,
             8.92384016814182,
             8.65809640564772,
             7.06519936133448,
             9.86855719596221,
             7.70710342506284,
             7.75352674962692,
             13.5203909079463,
             10.12574654597,
             7.61763710386151,
             14.7781887167321,
             11.1961001277806,
             9.25856061228804,
             11.106437911112,
             9.80805917249302,
             10.5086459011339,
             10.714323913644,
             8.23329529955243,
             10.4394973871938,
             12.4154817138587,
             10.3762129996744,
             9.18348112475112,
             9.31094510918426,
             9.7077740955565,
             11.1740573336271,
             10.8672511669352,
             12.8802670210768,
             10.6125493934486]

func getGrad(a1: Double, b2: Double) -> Double {
    let x: Double = 2
    let k: Double = 5
    let a2: Double = 6
    let b1: Double = 2
    var st: Double = 0
    
    var z1 = 0.0
    var z2 = 0.0

    var dz1 = 0.0
    var dz2 = 0.0

    let h = 0.5

    var y = 0.0
    
    for i in 0..<100 {
        dz1 = z1 + h * z2
        dz2 = z2 + h * (1/(b1 * b2)) * (x - z1 - (b1 + b2) * z2)
        
        y = k * (z1 - a1 * z2 + a2 * z2 + a1 * a2 * dz2)
        
        st = st + abs(array[i] - y)
        
        z1 = dz1
        z2 = dz2
    }
    
    print("(\(a1); \(b2))")
    //print("\(st)")
    return st
}

var i = 0
var a1 = 2.0
var b2 = 5.0
var stepA = 0.1
var stepB = 0.1
var tmpSum: Double = 0

var sum = getGrad(a1: a1, b2: b2)

repeat {
    tmpSum = getGrad(a1: a1 + stepA, b2: b2)
    if abs(tmpSum - sum) > 0.001 {
        if tmpSum < sum {
            a1 += stepA
            stepA *= 3
            sum = tmpSum
        } else {
            stepA *= -0.5
        }
        continue
    }
    tmpSum = getGrad(a1: a1, b2: b2 + stepB)
    if abs(tmpSum - sum) > 0.001 {
        if tmpSum < sum {
            b2 += stepB
            stepB *= 3
            sum = tmpSum
        } else {
            stepB *= -0.5
        }
        continue
    }
    
    break
} while(true)
